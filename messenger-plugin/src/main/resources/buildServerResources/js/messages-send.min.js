(function(a){var b={dialog:function(d,c){a("#messages-send-dialog-text").text(d);a("#messages-send-dialog").dialog({height:48,width:180,close:b.dialogClose});c>0&&b.dialogClose.delay(c)},dialogClose:function(){a("#messages-send-dialog").dialog("destroy");a("#messages-send-message").val("").focus();a("#messages-send-button").enable()}};a(function(){a("#messages-send-message").focus();a("#messages-send-dialog-ok").click(function(){b.dialogClose();return!1});a("#messages-send-all").change(function(){a("#messages-send-groups, #messages-send-users").disable(this.value==
"on")});a("#messages-send-all").click().change();a("#messages-send-form").submit(function(){if(a.trim(a("#messages-send-message").val()))a("#messages-send-message").removeClass("errorField"),a("#messages-send-error-message").text("");else return a("#messages-send-message").addClass("errorField"),a("#messages-send-error-message").text("Message is empty"),!1;if(a("#messages-send-all").attr("checked")||a("#messages-send-groups").val()||a("#messages-send-users").val())a("#messages-send-error-selection").text("");
else return a("#messages-send-error-selection").text("No recipients selected"),!1;a("#messages-send-button").disable();a("#messages-send-progress").show();a.ajax({url:this.action,type:"POST",data:a(this).serialize(),dataType:"text",success:function(a){b.dialog('Message "'+a+'" sent',1)},error:function(){b.dialog("Failed to send the message",-1)},complete:function(){a("#messages-send-progress").hide()}});return!1})})})(jQuery);