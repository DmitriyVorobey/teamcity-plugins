var ms;
(function(a){ms={dialog:function(b,c){a("#messages-send-dialog-text").text(b);a("#messages-send-dialog").dialog({height:40,width:180,close:ms.dialogClose});c>0&&ms.dialogClose.delay(c)},dialogClose:function(){a("#messages-send-dialog").dialog("destroy");a("#messages-send-button").enable();a("#messages-send-text").focus()}};a(function(){a("#messages-send-counter").text(messages_const.text_max_length);a("#messages-send-text").focus().keyup(function(){var b=a(this).val(),b=messages_const.text_max_length-b.length;
a("#messages-send-counter").text(b).css({color:b<1?"red":"#151515"})});a("#messages-send-dialog-ok").click(function(){ms.dialogClose();return!1});a("#messages-send-all").change(function(){a("#messages-send-groups, #messages-send-users").disable(a(this).is(":checked"))});a("#messages-send-all").click().change();a("#messages-send-form").submit(function(){var b=!1,c=a.trim(a("#messages-send-longevity-number").val());if(c.length&&(c=parseFloat(c),isNaN(c)||c<=0))a("#messages-send-longevity-number").addClass("errorField"),
a("#messages-send-error-longevity").text("Message longevity should be a positive number"),b=!0;b||(a("#messages-send-longevity-number").removeClass("errorField"),a("#messages-send-error-longevity").text(""));c=a("#messages-send-text").val();a.trim(c)?c.length>messages_const.text_max_length?(a("#messages-send-text").addClass("errorField"),a("#messages-send-error-message").text("Message should be no longer than "+messages_const.text_max_length+" characters."),b=!0):(a("#messages-send-text").removeClass("errorField"),
a("#messages-send-error-message").text("")):(a("#messages-send-text").addClass("errorField"),a("#messages-send-error-message").text("Message should be specified"),b=!0);a("#messages-send-all").attr("checked")||a("#messages-send-groups").val()||a("#messages-send-users").val()?a("#messages-send-error-selection").text(""):(a("#messages-send-error-selection").text("Recipients should be selected"),b=!0);b||(a("#messages-send-button").disable(),a("#messages-send-progress").show(),a.ajax({url:this.action,
type:"POST",data:a(this).serialize(),dataType:"text",success:function(b){ms.dialog('Message "'+b+'" sent',1);a("#messages-send-text").val("")},error:function(){ms.dialog("Failed to send message",-1)},complete:function(){a("#messages-send-progress").hide()}}));return!1})})})(jQuery.noConflict());