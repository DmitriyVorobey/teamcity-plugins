var ms;
(function(a){ms={dialog:function(c,b){a("#messages-send-dialog-text").text(c);a("#messages-send-dialog").dialog({height:40,width:180,close:ms.dialogClose});b>0&&ms.dialogClose.delay(b)},dialogClose:function(){a("#messages-send-dialog").dialog("destroy");a("#messages-send-button").enable();a("#messages-send-text").focus()},longevityValidate:function(c){var c=!c,b=a.trim(a(this).val());if(b&&(b=parseFloat(b),isNaN(b)||b<=0))return a(this).addClass("errorField"),a("#messages-send-error-longevity").text("If specified message longevity should be a positive number"),c&&
a(this).focus(),!1;a(this).removeClass("errorField");a("#messages-send-error-longevity").text("");return!0},textValidate:function(c){var c=!c,b=a.trim(a(this).val()),d=messages_const.text_max_length-b.length;a("#messages-send-counter").text(d).css({color:d<10?"red":"#151515"});if(c&&(!b||d<0))return a(this).addClass("errorField").focus(),a("#messages-send-error-message").text(b?"Message should be no longer than "+messages_const.text_max_length+" characters.":"Message should be specified"),!1;a(this).removeClass("errorField");
a("#messages-send-error-message").text("");return!0},recipientsValidate:function(c){var c=!c,b=a("#messages-send-all").is(":checked"),d=b||a("#messages-send-groups").val()||a("#messages-send-users").val();a("#messages-send-error-selection").text(c&&!d?"Recipients should be selected":"");a("#messages-send-groups, #messages-send-users").disable(b);return d},formSubmit:function(){var c=!ms.longevityValidate.call(a("#messages-send-longevity-number").get(0)),b=!ms.textValidate.call(a("#messages-send-text").get(0)),
d=!ms.recipientsValidate();!c&&!b&&!d&&(a("#messages-send-button").disable(),a("#messages-send-progress").show(),a.ajax({url:a(this).attr("action"),data:a(this).serialize(),type:"POST",dataType:"text",success:function(b){ms.dialog('Message "'+b+'" sent',1);a("#messages-send-text").val("").change()},error:function(){ms.dialog("Failed to send message",-1)},complete:function(){a("#messages-send-progress").hide()}}));return!1}};a(function(){a("#messages-send-counter").text(messages_const.text_max_length);
a("#messages-send-longevity-number").change(ms.longevityValidate);a("#messages-send-text").keyup(ms.textValidate).change(ms.textValidate).focus();a("#messages-send-all, #messages-send-groups, #messages-send-users").change(ms.recipientsValidate);a("#messages-send-dialog-ok").click(function(){ms.dialogClose();return!1});a("#messages-send-all").click().change();a("#messages-send-form").submit(ms.formSubmit)})})(jQuery.noConflict());